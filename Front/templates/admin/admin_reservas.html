{% extends "base.html" %} {% block content %}

<!-- Alertas de √©xito -->
{% if reserva_creada %}
<div
  id="alert-success"
  class="fixed top-4 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2"
>
  <span>‚úì</span>
  <span>Reserva creada exitosamente</span>
  <button id="button_alert_success" class="ml-4 text-white hover:text-gray-200">
    <span class="text-lg">&times;</span>
  </button>
</div>
{% endif %} {% if reserva_editada %}
<div
  id="alert-success"
  class="fixed top-4 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2"
>
  <span>‚úì</span>
  <span>Reserva actualizada exitosamente</span>
  <button id="button_alert_success" class="ml-4 text-white hover:text-gray-200">
    <span class="text-lg">&times;</span>
  </button>
</div>
{% endif %} {% if reserva_eliminada %}
<div
  id="alert-success"
  class="fixed top-4 right-4 z-50 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2"
>
  <span>üóëÔ∏è</span>
  <span>Reserva eliminada exitosamente</span>
  <button id="button_alert_success" class="ml-4 text-white hover:text-gray-200">
    <span class="text-lg">&times;</span>
  </button>
</div>
{% endif %}

<div
  class="min-h-screen bg-gradient-to-r from-black via-gray-900 to-yellow-600 text-white pt-24 px-6"
>
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8 mt-20">
      <div>
        <h1 class="text-4xl font-bold mb-2">Panel de Administraci√≥n</h1>
        <p class="text-gray-300">Gestiona las reservas de planes</p>
      </div>
      <a
        href="{{ url_for('nueva_reserva') }}"
        class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-semibold transition duration-200 shadow-lg"
      >
        + Nueva Reserva
      </a>
    </div>

    <!-- Estad√≠sticas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">Total Reservas</h3>
        <p class="text-3xl font-bold text-primary">{{ reservas|length }}</p>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">Usuarios Activos</h3>
        <p class="text-3xl font-bold text-primary">
          {% set usuarios_unicos = reservas | map(attribute='ID_Usuario') |
          unique | list %}{{ usuarios_unicos|length }}
        </p>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">Planes Activos</h3>
        <p class="text-3xl font-bold text-primary">
          {% set planes_unicos = reservas | map(attribute='ID_Plan') | unique |
          list %}{{ planes_unicos|length }}
        </p>
      </div>
    </div>

    <!-- Tabla de reservas -->
    <div class="bg-white/10 backdrop-blur-sm rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-black/20">
            <tr>
              <th
                class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider"
              >
                ID
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider"
              >
                Usuario
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider"
              >
                Plan
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider"
              >
                Nota
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider"
              >
                Acciones
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-white/10">
            {% for reserva in reservas %}
            <tr class="hover:bg-white/5 transition-colors">
              <td class="px-6 py-4 text-sm">{{ reserva.ID_AlquilerPlan }}</td>
              <td class="px-6 py-4 text-sm">
                {% if usuarios[reserva.ID_Usuario] %} {{
                usuarios[reserva.ID_Usuario].Nombre }} {{
                usuarios[reserva.ID_Usuario].Apellido }} {% else %} Usuario #{{
                reserva.ID_Usuario }} {% endif %}
              </td>
              <td class="px-6 py-4 text-sm">
                {% if planes[reserva.ID_Plan] %} {{
                planes[reserva.ID_Plan].Descripcion }} {% else %} Plan #{{
                reserva.ID_Plan }} {% endif %}
              </td>
              <td class="px-6 py-4 text-sm text-gray-300 truncate max-w-xs">
                {{ reserva.Nota }}
              </td>
              <td class="px-6 py-4 text-sm space-x-2">
                <a
                  href="{{ url_for('editar_reserva', id=reserva.ID_AlquilerPlan) }}"
                  class="inline-block bg-black hover:bg-black/85 text-white px-3 py-1 rounded text-xs font-medium transition"
                >
                  Editar
                </a>
                <button
                  onclick="confirmarEliminacion('{{ reserva.ID_AlquilerPlan }}', '{{ reserva.ID_AlquilerPlan }}')"
                  class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-medium transition cursor-pointer"
                >
                  Eliminar
                </button>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                <div class="text-lg mb-2">No hay reservas registradas</div>
                <p class="text-sm">Comienza agregando tu primera reserva</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmaci√≥n de eliminaci√≥n -->
<div
  id="modal-eliminar"
  class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-lg p-6 max-w-md mx-4">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">
      Confirmar eliminaci√≥n
    </h3>
    <p class="text-gray-600 mb-6">
      ¬øEst√°s seguro de que deseas eliminar la reserva
      <strong id="reserva-id"></strong>? Esta acci√≥n no se puede deshacer.
    </p>
    <div class="flex justify-end space-x-3">
      <button
        onclick="cerrarModal()"
        class="px-4 py-2 text-gray-600 bg-gray-200 rounded hover:bg-gray-300 transition cursor-pointer"
      >
        Cancelar
      </button>
      <form id="form-eliminar" method="POST" class="inline">
        <button
          type="submit"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition cursor-pointer"
        >
          Eliminar
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  function confirmarEliminacion(id, nombre) {
    document.getElementById("reserva-id").textContent = nombre;
    document.getElementById(
      "form-eliminar"
    ).action = `/admin/reserva/${id}/eliminar`;
    document.getElementById("modal-eliminar").classList.remove("hidden");
    document.getElementById("modal-eliminar").classList.add("flex");
  }

  function cerrarModal() {
    document.getElementById("modal-eliminar").classList.add("hidden");
    document.getElementById("modal-eliminar").classList.remove("flex");
  }

  // Cerrar alertas
  const alertSuccess = document.getElementById("alert-success");
  const buttonAlert = document.getElementById("button_alert_success");

  if (alertSuccess && buttonAlert) {
    buttonAlert.onclick = () => {
      alertSuccess.classList.add("hidden");
    };

    // Auto-ocultar despu√©s de 5 segundos
    setTimeout(() => {
      if (alertSuccess) {
        alertSuccess.classList.add("hidden");
      }
    }, 5000);
  }

  // Cerrar modal al hacer clic fuera
  document
    .getElementById("modal-eliminar")
    .addEventListener("click", function (e) {
      if (e.target === this) {
        cerrarModal();
      }
    });
</script>

{% endblock %}
